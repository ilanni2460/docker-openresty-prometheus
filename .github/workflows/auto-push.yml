name: AUTO TEST

#on:
#  schedule:
#  - cron: "0 0 * * *"
on:
  push:

jobs:
  check:
    name: check version
    runs-on: ubuntu-latest
    steps:
      - name: clone repo
        run: |
          git clone https://github.com/mohsenmottaghi/docker-openresty-prometheus.git
          cd docker-openresty-prometheus
      - name: get latest version
        run: |
          cd docker-openresty-prometheus
          LATEST=$(curl https://github.com/openresty/openresty/releases/latest | cut -d '"' -f 2 | cut -d '/' -f 8)
          CURRENT=$(cat VERSION)
          VERSION=$(bash check-version.sh $LATEST $CURRENT)
      - name: change files
        run: |
          cd docker-openresty-prometheus
          cat VERSION
          sed -i "s/$CURRENT/$VERSION/" VERSION
          cat VERSION
      - name: git commit
        run: |
          cd docker-openresty-prometheus
          git add -A
          git commit -m 'AUTO UPDATE'
          git push origin master
